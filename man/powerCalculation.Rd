% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/power_calculation.R
\name{powerCalculation}
\alias{powerCalculation}
\title{Power Calculation Using Bray–Curtis PERMANOVA for Microbiome Data Simulation}
\usage{
powerCalculation(
  data.type = c("gut", "oral", "infant", "custom"),
  method = c("amp", "wgs", "custom"),
  test_method = c("shannon", "invsimpson", "bray"),
  nSim = 100,
  alpha = 0.05,
  nSam = 100,
  nOTU = 200,
  diff.otu.pct = 0.1,
  diff.otu.direct = "balanced",
  diff.otu.mode = "abundant",
  user_specified_otu = NULL,
  covariate.type = "binary",
  grp.ratio = 1,
  covariate.eff.mean = 1,
  covariate.eff.sd = 0,
  confounder.type = "none",
  conf.cov.cor = 0.6,
  conf.diff.otu.pct = 0,
  conf.nondiff.otu.pct = 0.1,
  confounder.eff.mean = 0,
  confounder.eff.sd = 0,
  error.sd = 0,
  depth.mu = 10000,
  depth.theta = 5,
  depth.conf.factor = 0,
  cont.conf,
  epsilon,
  para.custom = NULL
)
}
\arguments{
\item{data.type}{A character string specifying the data type. Must be one of \code{"gut"},
\code{"oral"}, or \code{"infant"}.}

\item{method}{A character string specifying the sequencing/estimation method. Must be one
of \code{"amp"} or \code{"wgs"}.}

\item{nSim}{Number of simulation replicates. Default is 100.}

\item{alpha}{Significance level for the PERMANOVA test. Default is 0.05.}

\item{nSam}{Number of samples per simulation replicate. Default is 100.
**Note:** The maximum sample sizes are 206 for gut, 181 for oral, and 498 for infant.}

\item{nOTU}{Number of OTUs to simulate. Default is 500.}

\item{diff.otu.pct}{Proportion of OTUs that are differentially abundant. Default is 0.1.}

\item{diff.otu.direct}{Direction of differential OTUs. Either \code{"balanced"} or
\code{"unbalanced"}. Default is \code{"balanced"}.}

\item{diff.otu.mode}{Mode of differential OTUs. Options include \code{"abundant"},
\code{"rare"}, \code{"mix"}, or \code{"user_specified"}. Default is \code{"abundant"}.}

\item{user_specified_otu}{Optional vector specifying the OTUs that are differentially
abundant when \code{diff.otu.mode} is \code{"user_specified"}.}

\item{covariate.type}{Type of covariate; either \code{"binary"} or \code{"continuous"}.
Default is \code{"binary"}.}

\item{grp.ratio}{Group ratio for binary covariates. Default is 1.}

\item{covariate.eff.mean}{Mean effect size for the covariate. Default is 1.}

\item{covariate.eff.sd}{Standard deviation of the covariate effect. Default is 0.}

\item{confounder.type}{Type of confounding variable. Options are \code{"none"},
\code{"binary"}, \code{"continuous"}, or \code{"both"}. Default is \code{"none"}.}

\item{conf.cov.cor}{Correlation between the covariate and the confounder. Default is 0.6.}

\item{conf.diff.otu.pct}{Proportion of differential OTUs affected by the confounder.
Default is 0.}

\item{conf.nondiff.otu.pct}{Proportion of non-differential OTUs affected by the confounder.
Default is 0.1.}

\item{confounder.eff.mean}{Mean effect size for the confounder. Default is 0.}

\item{confounder.eff.sd}{Standard deviation of the confounder effect. Default is 0.}

\item{error.sd}{Standard deviation for the error term. Default is 0.}

\item{depth.mu}{Mean sequencing depth. Default is 10000.}

\item{depth.theta}{Theta parameter for the negative binomial distribution of sequencing depth.
Default is 5.}

\item{depth.conf.factor}{Factor for the covariate effect on sequencing depth. Default is 0.}

\item{cont.conf}{Numeric vector of continuous confounder values. Default is \code{rnorm(nSam)}.}

\item{epsilon}{Numeric vector of random error values. Default is \code{rnorm(nSam)}.}
}
\value{
A list with the following elements:
  \describe{
    \item{overall_power}{The overall estimated power as the proportion of simulation replicates
      detecting a significant group effect (PERMANOVA p-value < \code{alpha}).}
    \item{replicate_power}{A numeric vector of detection indicators (1 for detected, 0 for not)
      for each simulation replicate.}
  }
}
\description{
This function performs a simulation-based power calculation using Bray–Curtis distances
and PERMANOVA for microbiome data simulated by \code{SimulateMSeqU}. It supports three
data types ("gut", "oral", "infant") and two sequencing methods ("amp" and "wgs"). The
corresponding parameter file (e.g., "gut_amp_para.RData") is loaded from the package's data
folder to supply the estimated parameters.
}
\details{
For each simulation replicate, the function:
  \enumerate{
    \item Loads the corresponding parameter file (e.g., "gut_amp_para.RData") from the package's
      data folder and obtains the estimated parameters.
    \item Checks if \code{nSam} exceeds the maximum allowed sample size for the chosen data type.
    \item Simulates a microbiome dataset using \code{SimulateMSeqU}.
    \item Defines sample groups based on the covariate (dichotomizing if continuous).
    \item Computes Bray–Curtis distances via \code{vegdist} (with samples as rows).
    \item Performs PERMANOVA using \code{adonis2} to test the group effect.
    \item Records a detection if the PERMANOVA p-value for the Group effect is less than
      \code{alpha}.
  }
}
\examples{
\dontrun{
  # Valid example: For gut data the maximum sample size is 206.
  result <- powerCalculation(data.type = "gut", method = "amp", nSam = 206, nSim = 50)
  print(result$overall_power)

  # This example will error because the maximum sample size for oral data is 181.
  # result <- powerCalculation(data.type = "oral", method = "wgs", nSam = 200)
}

}
