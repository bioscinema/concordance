% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.R
\name{SimulateMSeqU}
\alias{SimulateMSeqU}
\title{Simulate Microbial Sequence Data with Estimated Hyper-parameters}
\usage{
SimulateMSeqU(
  para = EstPara,
  nSam = 100,
  nOTU = 500,
  diff.otu.pct = 0.1,
  diff.otu.direct = c("balanced", "unbalanced"),
  diff.otu.mode = c("abundant", "rare", "mix", "user_specified"),
  user_specified_otu = NULL,
  covariate.type = c("binary", "continuous"),
  grp.ratio = 1,
  covariate.eff.mean = 1,
  covariate.eff.sd = 0,
  confounder.type = c("none", "binary", "continuous", "both"),
  conf.cov.cor = 0.6,
  conf.diff.otu.pct = 0,
  conf.nondiff.otu.pct = 0.1,
  confounder.eff.mean = 0,
  confounder.eff.sd = 0,
  error.sd = 0,
  depth.mu = 10000,
  depth.theta = 5,
  depth.conf.factor = 0,
  cont.conf,
  epsilon
)
}
\arguments{
\item{para}{A list of estimated hyper-parameters. It is expected that \code{para$ref.otu.tab} contains a reference OTU table.}

\item{nSam}{Integer. Number of samples to simulate. Default is 100.}

\item{nOTU}{Integer. Number of OTUs to simulate. Default is 500.}

\item{diff.otu.pct}{Numeric. Proportion of OTUs that are differentially abundant. Default is 0.1.}

\item{diff.otu.direct}{Character. Direction of differential OTU effects. Must be either \code{"balanced"} or \code{"unbalanced"}.}

\item{diff.otu.mode}{Character. Mode for differential OTU effects. Options include \code{"abundant"}, \code{"rare"}, \code{"mix"}, or \code{"user_specified"}.}

\item{user_specified_otu}{Optional. A vector of OTU names or indices to be set as differentially abundant when \code{diff.otu.mode} is \code{"user_specified"}.}

\item{covariate.type}{Character. Type of covariate to simulate; either \code{"binary"} or \code{"continuous"}.}

\item{grp.ratio}{Numeric. For binary covariates, the ratio between groups. Default is 1.}

\item{covariate.eff.mean}{Numeric. Mean effect size for the covariate. Default is 1.}

\item{covariate.eff.sd}{Numeric. Standard deviation of the covariate effect. Default is 0.}

\item{confounder.type}{Character. Type of confounder to simulate. Options are \code{"none"}, \code{"binary"}, \code{"continuous"}, or \code{"both"}.}

\item{conf.cov.cor}{Numeric. Correlation between the covariate and the confounder. Default is 0.6.}

\item{conf.diff.otu.pct}{Numeric. Proportion of differential OTUs affected by the confounder. Default is 0.}

\item{conf.nondiff.otu.pct}{Numeric. Proportion of non-differential OTUs affected by the confounder. Default is 0.1.}

\item{confounder.eff.mean}{Numeric. Mean effect size for the confounder. Default is 0.}

\item{confounder.eff.sd}{Numeric. Standard deviation of the confounder effect. Default is 0.}

\item{error.sd}{Numeric. Standard deviation for the error term. Default is 0.}

\item{depth.mu}{Numeric. Mean sequencing depth. Default is 10000.}

\item{depth.theta}{Numeric. Theta parameter for the negative binomial distribution modeling sequencing depth. Default is 5.}

\item{depth.conf.factor}{Numeric. Factor for the covariate effect on sequencing depth. Default is 0.}

\item{cont.conf}{Numeric vector. Continuous confounder values. Required if \code{confounder.type} is \code{"continuous"} or \code{"both"}.}

\item{epsilon}{Numeric vector. Error values for the covariate simulation; typically generated with \code{rnorm(nSam)}.}
}
\value{
A list containing:
  \describe{
    \item{otu.tab.sim}{A matrix of simulated OTU counts (rows correspond to OTUs, columns to samples).}
    \item{covariate}{A matrix or vector of simulated covariate values for each sample.}
    \item{confounder}{A matrix of simulated confounder values (if applicable), or \code{NULL} if not used.}
    \item{diff.otu.ind}{A logical vector indicating which OTUs are truly differential.}
    \item{otu.names}{A character vector of OTU names used in the simulation.}
    \item{conf.otu.ind}{A logical vector indicating which OTUs are affected by the confounder.}
  }
}
\description{
This function simulates microbial sequence count data based on a set of estimated Dirichlet parameters.
It generates simulated OTU counts for a specified number of samples (\code{nSam}) and OTUs (\code{nOTU}),
incorporating differential abundance according to the specified proportion and mode. Effects of a covariate
(and optionally a confounder) are modeled, sequencing depth is simulated using a negative binomial distribution,
and the final OTU counts are obtained via multinomial sampling.
}
\details{
The simulation process involves the following steps:
\enumerate{
  \item Subsetting the reference OTU table to the specified numbers of OTUs (\code{nOTU}) and samples (\code{nSam}).
  \item Simulating a confounding variable based on the specified \code{confounder.type}.
  \item Generating a covariate with a given correlation (\code{conf.cov.cor}) with the confounder and incorporating error (\code{epsilon}).
  \item Introducing differential abundance among OTUs according to the chosen direction and mode.
  \item Simulating sequencing depth using a negative binomial distribution, followed by generation of
        absolute OTU counts via multinomial sampling.
}
}
